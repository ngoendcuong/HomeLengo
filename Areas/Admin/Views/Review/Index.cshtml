@model IEnumerable<HomeLengo.Models.Review>
@{
    ViewData["Title"] = "Reviews";
}

<div class="main-content">
    <div class="main-content-inner">
        <h4 class="fw-7 mb-4">Reviews</h4>

        <div class="widget-box-2 wd-listing">
            <form method="get" action="/Admin/Review" class="wd-filter mb-3">
                <div class="row g-3">
                    <div class="col-md-8">
                        <div class="ip-group icon-left">
                            <input type="text" name="searchString" value="@ViewBag.SearchString" placeholder="Search reviews...">
                            <span class="icon icon-search"></span>
                        </div>
                    </div>
                    <div class="col-md-2">
                        <div class="ip-group">
                            <select name="isApproved" class="form-select">
                                <option value="">All</option>
                                <option value="true" selected="@(ViewBag.IsApproved == true)">Approved</option>
                                <option value="false" selected="@(ViewBag.IsApproved == false)">Pending</option>
                            </select>
                        </div>
                    </div>
                    <div class="col-md-2">
                        <button type="submit" class="tf-btn primary w-100">Search</button>
                    </div>
                </div>
            </form>

            <div class="d-flex gap-4 mb-3">
                <span class="text-primary fw-7">@ViewBag.TotalCount</span>
                <span class="fw-6">Reviews found</span>
            </div>

            <div class="wrap-table">
                <div class="table-responsive">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Property</th>
                                <th>User</th>
                                <th>Rating</th>
                                <th>Title</th>
                                <th>Status</th>
                                <th>Date</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            @if (Model != null && Model.Any())
                            {
                                @foreach (var review in Model)
                                {
                                    <tr>
                                        <td>
                                            <div class="fw-6">@review.Property.Title</div>
                                            <small class="text-muted">ID: @review.PropertyId</small>
                                        </td>
                                        <td>@(review.User?.FullName ?? review.User?.Username ?? "Unknown")</td>
                                        <td>
                                            <ul class="list-star d-flex gap-1">
                                                @for (int i = 0; i < 5; i++)
                                                {
                                                    <li class="icon @(i < review.Rating ? "icon-star" : "icon-star-empty")"></li>
                                                }
                                            </ul>
                                        </td>
                                        <td>@(review.Title ?? "No title")</td>
                                        <td>
                                            <span class="btn-status @(review.IsApproved == true ? "" : "status-pending")">
                                                @(review.IsApproved == true ? "Approved" : "Pending")
                                            </span>
                                        </td>
                                        <td>
                                            <small>@(review.CreatedAt?.ToString("MMM dd, yyyy") ?? "N/A")</small>
                                        </td>
                                        <td>
                                            <ul class="list-action d-flex gap-2">
                                                <li>
                                                    <a href="/Admin/Review/Details/@review.ReviewId" class="item" title="View">
                                                        <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                                                            <path d="M8 3C4.667 3 2 5.667 2 9C2 12.333 4.667 15 8 15C11.333 15 14 12.333 14 9C14 5.667 11.333 3 8 3ZM8 13.5C5.5 13.5 3.5 11.5 3.5 9C3.5 6.5 5.5 4.5 8 4.5C10.5 4.5 12.5 6.5 12.5 9C12.5 11.5 10.5 13.5 8 13.5Z" fill="#A3ABB0"/>
                                                            <path d="M8 6.5C6.9 6.5 6 7.4 6 8.5C6 9.6 6.9 10.5 8 10.5C9.1 10.5 10 9.6 10 8.5C10 7.4 9.1 6.5 8 6.5Z" fill="#A3ABB0"/>
                                                        </svg>
                                                    </a>
                                                </li>
                                                <li>
                                                    <form method="post" action="/Admin/Review/ToggleApproved/@review.ReviewId" style="display:inline;">
                                                        @Html.AntiForgeryToken()
                                                        <button type="submit" class="item" title="@(review.IsApproved == true ? "Unapprove" : "Approve")" style="background:none; border:none; padding:0;">
                                                            <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                                                                <path d="M13.5 4L6 11.5L2.5 8" stroke="#A3ABB0" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                                            </svg>
                                                        </button>
                                                    </form>
                                                </li>
                                                <li>
                                                    <form method="post" action="/Admin/Review/Delete/@review.ReviewId" style="display:inline;">
                                                        @Html.AntiForgeryToken()
                                                        <button type="submit" class="remove-file item" title="Delete" onclick="return confirm('Are you sure?');" style="background:none; border:none; padding:0;">
                                                            <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                                                                <path d="M9.82667 6.00035L9.596 12.0003M6.404 12.0003L6.17333 6.00035M12.8187 3.86035C13.0467 3.89501 13.2733 3.93168 13.5 3.97101M12.8187 3.86035L12.1067 13.1157C12.0776 13.4925 11.9074 13.8445 11.63 14.1012C11.3527 14.3579 10.9886 14.5005 10.6107 14.5003H5.38933C5.0114 14.5005 4.64735 14.3579 4.36999 14.1012C4.09262 13.8445 3.92239 13.4925 3.89333 13.1157L3.18133 3.86035M12.8187 3.86035C12.0492 3.74403 11.2758 3.65574 10.5 3.59568M3.18133 3.86035C2.95333 3.89435 2.72667 3.93101 2.5 3.97035M3.18133 3.86035C3.95076 3.74403 4.72416 3.65575 5.5 3.59568M10.5 3.59568V2.98501C10.5 2.19835 9.89333 1.54235 9.10667 1.51768C8.36908 1.49411 7.63092 1.49411 6.89333 1.51768C6.10667 1.54235 5.5 2.19901 5.5 2.98501V3.59568M10.5 3.59568C8.83581 3.46707 7.16419 3.46707 5.5 3.59568" stroke="#A3ABB0" stroke-linecap="round" stroke-linejoin="round" />
                                                            </svg>
                                                        </button>
                                                    </form>
                                                </li>
                                            </ul>
                                        </td>
                                    </tr>
                                }
                            }
                            else
                            {
                                <tr>
                                    <td colspan="7" class="text-center py-4">No reviews found</td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>

                @if (ViewBag.TotalPages > 1)
                {
                    <ul class="wd-navigation">
                        @if (ViewBag.CurrentPage > 1)
                        {
                            <li><a href="?page=@(ViewBag.CurrentPage - 1)&searchString=@ViewBag.SearchString&isApproved=@ViewBag.IsApproved" class="nav-item"><i class="icon icon-arr-l"></i></a></li>
                        }
                        @for (int i = 1; i <= ViewBag.TotalPages; i++)
                        {
                            if (i == ViewBag.CurrentPage)
                            {
                                <li><a href="#" class="nav-item active">@i</a></li>
                            }
                            else if (i <= 3 || i > ViewBag.TotalPages - 3 || (i >= ViewBag.CurrentPage - 1 && i <= ViewBag.CurrentPage + 1))
                            {
                                <li><a href="?page=@i&searchString=@ViewBag.SearchString&isApproved=@ViewBag.IsApproved" class="nav-item">@i</a></li>
                            }
                            else if (i == 4 || i == ViewBag.TotalPages - 3)
                            {
                                <li><a href="#" class="nav-item">...</a></li>
                            }
                        }
                        @if (ViewBag.CurrentPage < ViewBag.TotalPages)
                        {
                            <li><a href="?page=@(ViewBag.CurrentPage + 1)&searchString=@ViewBag.SearchString&isApproved=@ViewBag.IsApproved" class="nav-item"><i class="icon icon-arr-r"></i></a></li>
                        }
                    </ul>
                }
            </div>
        </div>
    </div>
</div>
